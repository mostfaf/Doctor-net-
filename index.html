<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>دكتور نت - أدوات مايكروتيك</title>
<meta name="description" content="دكتور نت - منصة متكاملة لأدوات MikroTik مع شرح تفصيلي وتجربة مستخدم متكاملة." />
<meta name="author" content="مصطفى عاطف الشوري" />
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  /* تصميم عصري */
  body {
    font-family: 'Cairo', sans-serif;
    background: linear-gradient(135deg,#001f4d,#004aad);
    color: #222;
    margin: 0; padding: 20px;
    min-height: 100vh;
    display: flex; justify-content: center;
  }
  #wrap {
    background: #fff;
    width: 900px;
    border-radius: 15px;
    padding: 30px 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  header {
    text-align: center;
    margin-bottom: 25px;
  }
  .logo-img {
    width: 150px; height: 150px;
    border-radius: 50%;
    border: 6px solid #004aad;
    box-shadow: 0 0 20px #0073e6;
    margin: 0 auto;
  }
  h1 {
    color: #004aad;
    margin-top: 15px;
    font-weight: 700;
  }
  .warning {
    background: #fff3cd;
    color: #856404;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #ffeeba;
    font-weight: 600;
    margin-bottom: 30px;
    text-align: center;
  }
  label {
    font-weight: 700;
    color: #004aad;
    display: block;
    margin-bottom: 8px;
  }
  select, input, textarea {
    width: 100%;
    padding: 12px 15px;
    margin-bottom: 20px;
    border-radius: 10px;
    border: 2px solid #004aad;
    font-size: 16px;
    background: #eaf4ff;
    outline: none;
  }
  select:hover, select:focus, input:focus, textarea:focus {
    background: #d1e7ff;
  }
  button {
    width: 100%;
    padding: 16px;
    background: #004aad;
    color: white;
    font-weight: 700;
    font-size: 18px;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(0,67,173,0.7);
    user-select: none;
  }
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
    box-shadow: none;
  }
  button:hover:not(:disabled) {
    background: #002e6d;
  }
  #error {
    color: #dc3545;
    font-weight: 700;
    text-align: center;
    margin: 15px 0;
    display: none;
  }
  #answer {
    margin-top: 30px;
    display: none;
    position: relative;
  }
  #answer-text {
    width: 100%;
    height: 300px;
    font-family: Consolas, monospace;
    font-size: 14px;
    padding: 20px;
    border-radius: 15px;
    border: 2px solid #004aad;
    background: #f0f8ff;
    white-space: pre-wrap;
    overflow-y: auto;
  }
  #copy {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #28a745;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 50px;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 6px 18px rgba(40,167,69,0.8);
  }
  #copy:hover {
    background: #1e7e34;
  }
  .tool-description {
    background: #d9e9ff;
    border-radius: 12px;
    padding: 15px 20px;
    margin-bottom: 25px;
    color: #004aad;
    font-weight: 600;
    line-height: 1.5;
  }
  footer.disclaimer, footer.footer {
    text-align: center;
    color: #004aad;
    font-weight: 700;
    margin-top: 40px;
    user-select: none;
  }
  footer.footer {
    font-weight: 500;
    margin-bottom: 10px;
  }
  .support-floating {
    position: fixed;
    bottom: 25px;
    left: 25px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .support-btn, .booking-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    background-color: #004aad;
    color: white;
    border-radius: 50px;
    padding: 14px 28px;
    font-weight: 700;
    font-size: 16px;
    box-shadow: 0 6px 20px rgba(0,67,173,0.7);
    cursor: pointer;
    user-select: none;
    border: none;
  }
  .support-btn:hover, .booking-btn:hover {
    background-color: #002e6d;
    box-shadow: 0 8px 28px rgba(0,48,135,0.9);
  }
  .support-btn i, .booking-btn i {
    font-size: 22px;
  }
</style>
</head>
<body>
<div id="wrap" role="main" aria-label="موقع دكتور نت لأدوات مايكروتيك">
  <header>
    <img src="https://i.imgur.com/0PBLMuU.jpeg" alt="شعار دكتور نت" class="logo-img" loading="lazy" />
    <h1>دكتور نت - أدوات مايكروتيك</h1>
  </header>

  <div class="warning" role="alert" aria-live="polite">
    <strong>تنبيه مهم:</strong> دكتور نت غير مسؤول عن أي أضرار ناتجة عن الاستخدام الخاطئ لهذه الأدوات. يرجى مراجعة السكربتات بعناية قبل التطبيق.
  </div>

  <label for="tool">اختر الأداة:</label>
  <select id="tool" aria-describedby="tool-desc" aria-required="true">
    <option value="" disabled selected>-- اختر أداة --</option>
    <option value="simple-queue">مولد Simple Queue</option>
    <option value="queue-tree">مولد Queue Tree</option>
    <option value="pcq">مولد PCQ</option>
    <option value="load-balancing-pcc">موازنة الحمل PCC</option>
    <option value="load-balancing-nth">موازنة الحمل NTH</option>
    <option value="load-balancing-ecmp">موازنة الحمل ECMP</option>
    <option value="vpn-pptp">نفق VPN PPTP</option>
    <option value="firewall-basic">جدار حماية أساسي</option>
    <option value="dhcp-server">خادم DHCP</option>
    <option value="hotspot-setup">إعداد Hotspot</option>
    <option value="capsman">إعداد CAPsMAN</option>
    <option value="general">سؤال عام</option>
  </select>

  <div id="tool-desc" class="tool-description" aria-live="polite"></div>

  <form id="tool-form" novalidate>
    <div id="inputs"></div>
    <button id="submit" disabled>إنشاء السكربت</button>
  </form>

  <section id="answer" aria-label="السكريبت الناتج" style="display:none; position: relative; margin-top: 40px;">
    <textarea id="answer-text" readonly aria-readonly="true" aria-label="نص السكربت الناتج"></textarea>
    <button id="copy" aria-label="نسخ السكربت" title="نسخ السكربت"><i class="fas fa-copy"></i> نسخ السكربت</button>
  </section>

  <p id="error" role="alert" aria-live="assertive" style="color:#dc3545; font-weight:700; text-align:center; margin-top:20px; display:none;"></p>

  <footer class="disclaimer">
    جميع الحقوق محفوظة لـ مصطفى عاطف الشوري برعاية سيستم سمارت راديوس © 2025
  </footer>
  <footer class="footer">
    تم تطوير الموقع لدعم مجتمع MikroTik بأفضل الأدوات والسكربتات.
  </footer>
</div>

<div class="support-floating" aria-label="التواصل والدعم الفني">
  <button class="support-btn" id="supportBtn" aria-haspopup="dialog" aria-controls="supportModal" title="الدعم الفني المباشر">
    <i class="fas fa-headset"></i> دعم فني مباشر
  </button>
  <a href="https://mostfaf.github.io/Doctor-net/" target="_blank" rel="noopener" class="booking-btn" title="حجز موعد للدعم الفني">
    <i class="fas fa-calendar-check"></i> حجز موعد
  </a>
</div>

<dialog id="supportModal" aria-modal="true" role="dialog" aria-labelledby="supportTitle" aria-describedby="supportDesc">
  <h2 id="supportTitle">الدعم الفني المباشر</h2>
  <p id="supportDesc">يمكنك التواصل معنا مباشرة عبر الدردشة أو الفيديو لطلب الدعم الفني.</p>
  <div id="supportChat" style="height:300px; background:#f0f0f0; border-radius:8px; overflow-y:auto; padding:10px; font-family: monospace; font-size:14px;">
    <p><em>جاري تفعيل نظام الدعم الفني...</em></p>
  </div>
  <button id="closeSupport" aria-label="إغلاق الدعم الفني" style="margin-top:15px; padding:10px 20px; background:#004aad; color:#fff; border:none; border-radius:8px; cursor:pointer;">إغلاق</button>
</dialog>

<script>
const toolsDatabase = {
  'simple-queue': {
    description: 'تحديد سرعة الإنترنت لكل عميل أو IP بسهولة باستخدام Simple Queue.',
    inputs: [
      { id: 'ip', label: 'عنوان IP العميل', placeholder: 'مثال: 192.168.1.100', type: 'text' },
      { id: 'speed', label: 'سرعة التحميل/الرفع', placeholder: 'مثال: 5M/5M', type: 'text' },
      { id: 'name', label: 'اسم العميل', placeholder: 'مثال: client1', type: 'text' }
    ],
    repeatable: true,
    script(entries) {
      let script = '# Simple Queue Script\n# بواسطة مصطفى عاطف الشوري\n/queue simple\n';
      entries.forEach((e,i) => {
        const ip = e.ip || `192.168.1.${i+10}`;
        const speed = e.speed || '2M/2M';
        const name = e.name || `client${i+1}`;
        script += `add name=${name} target=${ip}/32 max-limit=${speed} comment="Generated by Dr. Net"\n`;
      });
      return script;
    }
  },
  'load-balancing-pcc': {
    description: 'توزيع الحمل على عدة خطوط إنترنت باستخدام PCC مع واجهة LAN واحدة.',
    inputs: [
      { id: 'lanInterface', label: 'واجهة LAN', placeholder: 'مثال: ether2', type: 'text' },
      { id: 'wanIp', label: 'IP واجهة WAN', placeholder: 'مثال: 192.168.1.2', type: 'text' },
      { id: 'wanGw', label: 'بوابة WAN', placeholder: 'مثال: 192.168.1.1', type: 'text' },
      { id: 'wanInterface', label: 'واجهة WAN', placeholder: 'مثال: ether1', type: 'text' }
    ],
    repeatable: true,
    script(entries) {
      let script = '# PCC Load Balancing\n# بواسطة مصطفى عاطف الشوري\n/ip firewall mangle\n';
      entries.forEach((e,i) => {
        script += `add chain=prerouting dst-address-type=!local in-interface=${e.lanInterface} per-connection-classifier=both-addresses:${entries.length}/${i} action=mark-connection new-connection-mark=wan${i+1}_conn passthrough=yes comment="WAN${i+1} PCC"\n`;
        script += `add chain=prerouting connection-mark=wan${i+1}_conn in-interface=${e.lanInterface} action=mark-routing new-routing-mark=to_wan${i+1} passthrough=yes comment="WAN${i+1} Routing"\n`;
      });
      script += '/ip address\n';
      entries.forEach((e,i) => {
        script += `add address=${e.wanIp} interface=${e.wanInterface} comment="WAN${i+1} IP"\n`;
      });
      script += '/ip route\n';
      entries.forEach((e,i) => {
        script += `add dst-address=0.0.0.0/0 gateway=${e.wanGw} routing-mark=to_wan${i+1} check-gateway=ping comment="WAN${i+1} Route"\n`;
      });
      script += '/ip firewall nat\n';
      entries.forEach((e,i) => {
        script += `add chain=srcnat out-interface=${e.wanInterface} action=masquerade comment="WAN${i+1} NAT"\n`;
      });
      return script;
    }
  },
  'load-balancing-nth': {
    description: 'موازنة الحمل NTH لتوزيع الطلبات بالتساوي على عدة خطوط WAN.',
    inputs: [
      { id: 'lanInterface', label: 'واجهة LAN', placeholder: 'مثال: ether2', type: 'text' },
      { id: 'wanIp', label: 'IP واجهة WAN', placeholder: 'مثال: 192.168.1.2', type: 'text' },
      { id: 'wanGw', label: 'بوابة WAN', placeholder: 'مثال: 192.168.1.1', type: 'text' },
      { id: 'wanInterface', label: 'واجهة WAN', placeholder: 'مثال: ether1', type: 'text' }
    ],
    repeatable: true,
    script(entries) {
      let script = '# NTH Load Balancing\n# بواسطة مصطفى عاطف الشوري\n/ip firewall mangle\n';
      entries.forEach((e,i) => {
        script += `add chain=prerouting in-interface=${e.lanInterface} nth=${entries.length} nth-mask=0 nth-index=${i} action=mark-routing new-routing-mark=to_wan${i+1} passthrough=yes comment="WAN${i+1} NTH"\n`;
      });
      script += '/ip address\n';
      entries.forEach((e,i) => {
        script += `add address=${e.wanIp} interface=${e.wanInterface} comment="WAN${i+1} IP"\n`;
      });
      script += '/ip route\n';
      entries.forEach((e,i) => {
        script += `add dst-address=0.0.0.0/0 gateway=${e.wanGw} routing-mark=to_wan${i+1} check-gateway=ping comment="WAN${i+1} Route"\n`;
      });
      script += '/ip firewall nat\n';
      entries.forEach((e,i) => {
        script += `add chain=srcnat out-interface=${e.wanInterface} action=masquerade comment="WAN${i+1} NAT"\n`;
      });
      return script;
    }
  },
  // أضف باقي الأدوات بنفس الطريقة مع شرح دقيق وسكربتات صحيحة...
  'general': {
    description: 'اكتب سؤالك أو طلبك الخاص وسيتم الرد عليك.',
    inputs: [
      { id: 'question', label: 'سؤالك أو طلبك', placeholder: 'مثال: كيف أضيف قاعدة في الجدار الناري؟', type: 'textarea' }
    ],
    repeatable: false,
    script(entries) {
      return `# سؤال عام من المستخدم:\n# ${entries[0].question || ''}\n# يرجى التواصل مع الدعم الفني للمساعدة.\n`;
    }
  }
};

const toolSelect = document.getElementById('tool');
const toolDesc = document.getElementById('tool-desc');
const inputsDiv = document.getElementById('inputs');
const submitBtn = document.getElementById('submit');
const errorP = document.getElementById('error');
const answerDiv = document.getElementById('answer');
const answerText = document.getElementById('answer-text');
const copyBtn = document.getElementById('copy');

const supportBtn = document.getElementById('supportBtn');
const supportModal = document.getElementById('supportModal');
const closeSupportBtn = document.getElementById('closeSupport');
const supportChat = document.getElementById('supportChat');

let currentTool = null;
let repeatableCount = 1;

function createInputField(input, repeatIndex) {
  const wrapper = document.createElement('div');
  wrapper.className = 'input-group';
  wrapper.style.marginBottom = '15px';

  const label = document.createElement('label');
  label.htmlFor = `${input.id}-${repeatIndex}`;
  label.textContent = input.label;
  wrapper.appendChild(label);

  let inputElement;
  if (input.type === 'textarea') {
    inputElement = document.createElement('textarea');
    inputElement.rows = 3;
  } else {
    inputElement = document.createElement('input');
    inputElement.type = input.type || 'text';
  }
  inputElement.id = `${input.id}-${repeatIndex}`;
  inputElement.name = input.id;
  inputElement.placeholder = input.placeholder || '';
  inputElement.setAttribute('aria-label', input.label);
  inputElement.required = true;
  inputElement.style.width = '100%';
  inputElement.style.padding = '10px';
  inputElement.style.borderRadius = '8px';
  inputElement.style.border = '1px solid #ccc';
  inputElement.style.fontSize = '15px';
  wrapper.appendChild(inputElement);

  return wrapper;
}

function clearInputs() {
  inputsDiv.innerHTML = '';
  errorP.style.display = 'none';
  answerDiv.style.display = 'none';
  submitBtn.disabled = true;
  repeatableCount = 1;
}

function addRepeatableInputs() {
  const groupWrapper = document.createElement('fieldset');
  groupWrapper.style.border = '1.5px dashed #ccc';
  groupWrapper.style.padding = '15px 20px';
  groupWrapper.style.marginBottom = '15px';
  groupWrapper.style.borderRadius = '10px';
  groupWrapper.setAttribute('aria-label', `مجموعة مدخلات رقم ${repeatableCount}`);

  const legend = document.createElement('legend');
  legend.textContent = `المدخل رقم ${repeatableCount}`;
  legend.style.fontWeight = '700';
  legend.style.color = '#004aad';
  groupWrapper.appendChild(legend);

  currentTool.inputs.forEach((input) => {
    groupWrapper.appendChild(createInputField(input, repeatableCount));
  });

  if (repeatableCount > 1) {
    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.className = 'remove-btn';
    removeBtn.textContent = 'حذف هذه المجموعة -';
    removeBtn.style.backgroundColor = '#dc3545';
    removeBtn.style.color = 'white';
    removeBtn.style.border = 'none';
    removeBtn.style.padding = '8px 15px';
    removeBtn.style.borderRadius = '8px';
    removeBtn.style.cursor = 'pointer';
    removeBtn.style.fontWeight = '600';
    removeBtn.style.marginTop = '10px';
    removeBtn.addEventListener('click', () => {
      groupWrapper.remove();
      repeatableCount--;
      const fieldsets = inputsDiv.querySelectorAll('fieldset');
      fieldsets.forEach((fs, i) => {
        fs.querySelector('legend').textContent = `المدخل رقم ${i + 1}`;
      });
    });
    groupWrapper.appendChild(removeBtn);
  }

  const addBtn = inputsDiv.querySelector('button.add-btn');
  if (addBtn) {
    inputsDiv.insertBefore(groupWrapper, addBtn);
  } else {
    inputsDiv.appendChild(groupWrapper);
  }
}

function buildInputs(toolKey) {
  clearInputs();
  if (!toolKey || !toolsDatabase[toolKey]) return;

  currentTool = toolsDatabase[toolKey];
  toolDesc.textContent = currentTool.description || '';

  if (currentTool.repeatable) {
    addRepeatableInputs();
    const addBtn = document.createElement('button');
    addBtn.type = 'button';
    addBtn.className = 'add-btn';
    addBtn.textContent = 'إضافة مدخل جديد +';
    addBtn.style.backgroundColor = '#28a745';
    addBtn.style.color = 'white';
    addBtn.style.border = 'none';
    addBtn.style.padding = '10px 20px';
    addBtn.style.borderRadius = '8px';
    addBtn.style.cursor = 'pointer';
    addBtn.style.fontWeight = '600';
    addBtn.style.marginTop = '10px';
    addBtn.addEventListener('click', () => {
      repeatableCount++;
      addRepeatableInputs();
    });
    inputsDiv.appendChild(addBtn);
  } else {
    currentTool.inputs.forEach(input => {
      inputsDiv.appendChild(createInputField(input, 0));
    });
  }
  submitBtn.disabled = false;
}

function collectInputs() {
  if (!currentTool) return [];
  let entries = [];
  if (currentTool.repeatable) {
    const fieldsets = inputsDiv.querySelectorAll('fieldset');
    fieldsets.forEach(fs => {
      let entry = {};
      currentTool.inputs.forEach(input => {
        const el = fs.querySelector(`#${input.id}-${fieldsets.length > 1 ? fs.querySelector('legend').textContent.match(/\d+/)[0] : 1}`);
        if (el) entry[input.id] = el.value.trim();
      });
      entries.push(entry);
    });
  } else {
    let entry = {};
    currentTool.inputs.forEach(input => {
      const el = inputsDiv.querySelector(`#${input.id}-0`);
      if (el) entry[input.id] = el.value.trim();
    });
    entries.push(entry);
  }
  return entries;
}

function validateInputs(entries) {
  for (const entry of entries) {
    for (const key in entry) {
      if (!entry[key]) {
        return `الرجاء تعبئة الحقل "${key}" في جميع المجموعات.`;
      }
    }
  }
  return '';
}

function generateScript() {
  errorP.style.display = 'none';
  answerDiv.style.display = 'none';
  answerText.value = '';

  const entries = collectInputs();
  const validationError = validateInputs(entries);
  if (validationError) {
    errorP.textContent = validationError;
    errorP.style.display = 'block';
    return;
  }

  try {
    const script = currentTool.script(entries);
    answerText.value = script;
    answerDiv.style.display = 'block';
    errorP.style.display = 'none';
  } catch (e) {
    errorP.textContent = 'حدث خطأ أثناء إنشاء السكربت. يرجى المحاولة مرة أخرى.';
    errorP.style.display = 'block';
    console.error(e);
  }
}

copyBtn.addEventListener('click', () => {
  answerText.select();
  answerText.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(answerText.value).then(() => {
    alert('تم نسخ السكربت إلى الحافظة!');
  }).catch(() => {
    alert('فشل النسخ. يرجى النسخ يدوياً.');
  });
});

toolSelect.addEventListener('change', () => {
  buildInputs(toolSelect.value);
});

submitBtn.addEventListener('click', e => {
  e.preventDefault();
  generateScript();
});

supportBtn.addEventListener('click', () => {
  supportModal.showModal();
  supportChat.innerHTML = '<p>جاري تفعيل نظام الدعم الفني المباشر...</p>';
  setTimeout(() => {
    supportChat.innerHTML = '<p><strong>مرحباً! كيف يمكننا مساعدتك اليوم؟</strong></p>';
  }, 1500);
});

closeSupportBtn.addEventListener('click', () => {
  supportModal.close();
});

supportModal.addEventListener('click', event => {
  const rect = supportModal.getBoundingClientRect();
  if (
    event.clientX < rect.left ||
    event.clientX > rect.right ||
    event.clientY < rect.top ||
    event.clientY > rect.bottom
  ) {
    supportModal.close();
  }
});

submitBtn.disabled = true;
</script>
</body>
</html>
